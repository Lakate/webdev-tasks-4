$gallery_item_count = 7
$gallery_width = 80%
$old_checked_item = 4
$start_center_item = 4

rotate_item($checked_item)

main
    width: 100%
    display: flex
    flex-direction: column
    align-items: center

.gallery
    width: $gallery_width
    height: 500px
    display: flex
    align-items: center
    justify-content: space-between
    perspective: 400px
    transform-style: preserve-3d

.gallery-item
    width: 14%
    display: flex
    flex-direction: column
    align-items: center
    position: relative
    perspective: 400px
    transform-style: preserve-3d
    position:relative
    top: 0
    left: 0
    transition: left 2s ease-out 0s, top 2s ease-in 0s, transform 1s ease-in-out 0s

    img
        width: 100%
        height: 150px
        display: block
        box-shadow: 0 0 5px 5px rgba(0, 0, 0, .3)

    &__control_invisible
        display: none

    for $item in (1..$gallery_item_count)
        &__control:nth-child({$item}):checked ~ .gallery &:nth-child({$item})
            transform: scale(1.5)
            z-index: 8
            left: ($old_checked_item - $item)*($gallery_width / $gallery_item_count)%
            $old_checked_item = $item
        for $item2 in (1..$gallery_item_count)
            &__control:nth-child({$item}):checked ~ .gallery &:nth-child({$item2})
                if $item2 < $item
                    transform: rotate3d(0, 1, 0, 20deg)
                if $item2 > $item
                    transform: rotate3d(0, 1, 0, -20deg)
                if $item2 != $item
                    left: ($start_center_item - $item)*($gallery_width / $gallery_item_count)%
